<!DOCTYPE html>
<html lang="lt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PRANK MASTER</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        :root { --bg-dark: #050510; --card-bg: #13132a; --primary: #7c4dff; --accent: #00e5ff; --danger: #ff0055; --gold: #ffd700; --text-main: #ffffff; --text-muted: #8888aa; --manta-green: #00ffaa; --panic: #ff9d00; }
        body { background-color: var(--bg-dark); color: var(--text-main); font-family: 'Roboto', sans-serif; margin: 0; overflow: hidden; }
        .hidden { display: none !important; }
        #splash-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100vh; background: #000; z-index: 9999; display: flex; justify-content: center; align-items: center; animation: forceHide 0.5s ease-in-out 2.0s forwards; pointer-events: none; }
        @keyframes forceHide { to { opacity: 0; visibility: hidden; } }
        .glitch { font-family: 'Orbitron'; font-size: 3rem; color: var(--primary); text-align: center; }
        #main-view { opacity: 0; animation: forceShow 0.5s ease-in-out 2.1s forwards; }
        @keyframes forceShow { to { opacity: 1; } }
        .status-bar { display: flex; justify-content: space-between; padding: 10px 15px; background: #0f0f1f; border-bottom: 1px solid #333; }
        .credit-pill { display: flex; align-items: center; gap: 10px; background: #1a1a2e; padding: 5px 10px; border-radius: 20px; border: 1px solid #333; }
        .credit-pill.pro { border-color: var(--accent); color: var(--accent); }
        .credit-pill.std { border-color: var(--gold); color: var(--gold); }
        .add-btn { background: #333; color: white; border: none; border-radius: 50%; width: 24px; height: 24px; cursor: pointer; }
        .scroll-content { height: calc(100vh - 140px); overflow-y: auto; padding-bottom: 20px; }
        .input-section { padding: 10px 20px; } 
        label { display: block; margin-bottom: 5px; font-weight: bold; font-family: 'Orbitron'; letter-spacing: 1px; font-size: 0.9rem; }
        .solid-section label { color: var(--manta-green); }
        .input-solid { width: 100%; padding: 15px; background: #020f0a; border: 2px solid var(--manta-green); color: var(--manta-green); border-radius: 6px; font-size: 1.2rem; text-align: center; font-family: 'Orbitron'; box-sizing: border-box; }
        .danger-section label { color: var(--danger); }
        .input-danger { width: 100%; padding: 15px; background: #1a050a; border: 2px solid var(--danger); color: var(--danger); border-radius: 6px; font-size: 1.2rem; text-align: center; font-family: 'Orbitron'; box-sizing: border-box; }
        .grid-section h2 { text-align: center; color: var(--text-muted); font-size: 0.9rem; margin: 15px 0; }
        .grid-container { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; padding: 0 15px; }
        .persona-card { background: var(--card-bg); border: 1px solid #333; border-radius: 12px; padding: 15px; text-align: center; cursor: pointer; transition: 0.2s; }
        .persona-card.selected { border-color: var(--primary); background: #1f1f3f; }
        .emoji-icon { font-size: 2.5rem; display: block; margin-bottom: 5px; }
        .main-footer { position: fixed; bottom: 0; width: 100%; padding: 15px; background: #050510; border-top: 1px solid #333; box-sizing: border-box; }
        .start-btn { width: 100%; padding: 15px; font-size: 1.1rem; font-weight: bold; border: none; border-radius: 8px; cursor: pointer; background: var(--primary); color: white; }
        .start-btn.disabled { background: #333; color: #555; pointer-events: none; }
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 3000; display: flex; justify-content: center; align-items: center; }
        .modal-content { background: #13132a; padding: 20px; border-radius: 15px; width: 90%; max-width: 400px; text-align: center; border: 2px solid #333; position: relative; }
        .close-modal { position: absolute; top: 10px; right: 15px; font-size: 24px; cursor: pointer; color: #fff; }
        .pricing-grid { display: flex; gap: 5px; margin-top: 15px; }
        .price-card { background: #000; padding: 10px; flex: 1; border-radius: 8px; border: 1px solid #333; cursor: pointer; }
        .big-num { font-size: 1.5rem; font-weight: bold; color: white; font-family: 'Orbitron'; }
        #control-view, #setup-view, #post-call-view { height: 100vh; display: flex; flex-direction: column; }
        .call-status { padding: 15px; background: #111; text-align: center; border-bottom: 1px solid #333; font-family: 'Orbitron'; font-size: 1.2rem; display: flex; justify-content: space-between; align-items: center; }
        .phrases-wrapper { flex: 1; overflow-y: auto; padding: 15px; }
        .phrase-btn { width: 100%; padding: 12px; margin-bottom: 8px; background: #1a1a2e; border: 1px solid #444; color: #ddd; text-align: left; border-radius: 5px; cursor: pointer; }
        .hangup-zone { padding: 20px; background: #000; display: flex; gap: 15px; border-top: 1px solid #333; }
        .action-btn { flex: 1; padding: 15px; border-radius: 30px; border: none; font-weight: bold; color: white; font-size: 1.1rem; cursor: pointer; display: flex; justify-content: center; gap: 10px; }
        .call-green { background: #34c759; } .call-red { background: #ff3b30; }
        .pro-input-area { padding: 10px; background: #1a1a3a; display: flex; gap: 10px; }
        #live-text { flex: 1; padding: 10px; }
        .call-panic { background: var(--panic); color: black; animation: pulse 2s infinite; display: none; }
    </style>
</head>
<body>

    <div id="splash-screen"><div class="logo-box"><h1 class="glitch">PRANK<br>MASTER</h1></div></div>

    <div id="main-view">
        <header class="status-bar">
            <div class="credit-pill std"><i class="fas fa-coins"></i> <span>KREDITAI <b id="std-amount">25</b></span><button class="add-btn" onclick="openModal('modal-std')">+</button></div>
            <div class="credit-pill pro"><i class="fas fa-gem"></i> <span>PRO <b id="pro-amount">5</b></span><button class="add-btn" onclick="openModal('modal-pro')">+</button></div>
        </header>

        <main class="scroll-content">
            <section class="input-section solid-section" style="padding-bottom: 0;">
                <label>TAVO NUMERIS</label>
                <input type="tel" id="user-phone" placeholder="+3706..." class="input-solid">
            </section>
            <section class="input-section danger-section" style="margin-top: 0; padding-top: 10px; border: none;">
                <label>AUKOS NUMERIS</label>
                <input type="tel" id="victim-phone" placeholder="+3706..." class="input-danger">
            </section>
            <section class="grid-section" style="border-top: 1px solid #333; padding-top: 20px; margin-top: 10px;">
                <h2>PASIRINK PERSONA≈ΩƒÑ</h2>
                <div id="persona-grid" class="grid-container"></div>
            </section>
        </main>
        
        <footer class="main-footer">
            <button id="btn-start-setup" class="start-btn disabled">PASIRINKITE PERSONA≈ΩƒÑ</button>
        </footer>
    </div>

    <div id="setup-view" class="hidden">
        <header class="status-bar"><h2>PARUO≈†TI FRAZES</h2></header>
        <div id="custom-phrases-list" style="padding:20px;"></div>
        <div style="padding:20px;"><button id="btn-confirm-call" class="start-btn">PRADƒñTI SKAMBUTƒÆ üìû</button></div>
    </div>

    <div id="control-view" class="hidden">
        <div class="call-status">
            <span id="rec-dot" style="color:red; opacity:0;">‚óè REC</span>
            <span id="call-timer">00:00</span>
            <span id="active-persona-label">PERSONA≈ΩAS</span>
        </div>
        <div class="phrases-wrapper">
            <h3>PRAD≈ΩIA</h3><div id="group-intro"></div>
            <h3>EIGA</h3><div id="group-middle"></div>
            <h3>PABAIGA</h3><div id="group-outro"></div>
        </div>
        <div id="pro-realtime" class="pro-input-area hidden">
            <input type="text" id="live-text" placeholder="Ra≈°yti AI..." class="input-solid" style="font-size:1rem;">
            <button id="btn-send-ai" style="width:50px; background:#00e5ff; border:none;">üöÄ</button>
        </div>
        <div class="hangup-zone">
            <button id="btn-real-start" class="action-btn call-green">SKAMBINTI</button>
            <button id="btn-end-call" class="action-btn call-red">BAIGTI</button>
        </div>
    </div>

    <div id="post-call-view" class="hidden" style="justify-content:center; align-items:center;">
        <div class="modal-content">
            <h2>BAIGTA</h2>
            <p>Trukmƒó: <span id="final-duration">00:00</span></p>
            <button onclick="location.reload()" class="start-btn">GRƒÆ≈ΩTI</button>
        </div>
    </div>

    <div id="modal-std" class="modal hidden">
        <div class="modal-content"><span class="close-modal" onclick="closeModal('modal-std')">&times;</span><h2 style="color:var(--gold)">PILDYTI KREDITUS</h2><div class="pricing-grid"><div class="price-card" onclick="buy('std',25,4.99)"><div class="big-num">25</div>4.99‚Ç¨</div><div class="price-card" onclick="buy('std',60,9.99)"><div class="big-num">60</div>9.99‚Ç¨</div></div></div>
    </div>
    <div id="modal-pro" class="modal hidden">
        <div class="modal-content"><span class="close-modal" onclick="closeModal('modal-pro')">&times;</span><h2 style="color:var(--accent)">PRO KREDITAI</h2><div class="pricing-grid"><div class="price-card" onclick="buy('pro',5,11.99)"><div class="big-num">5</div>11.99‚Ç¨</div><div class="price-card" onclick="buy('pro',10,19.99)"><div class="big-num">10</div>19.99‚Ç¨</div></div></div>
    </div>

    <script>
        // GLOBALIOS FUNKCIJOS
        function openModal(id) { document.getElementById(id).classList.remove('hidden'); }
        function closeModal(id) { document.getElementById(id).classList.add('hidden'); }
        function buy(type, amount, price) { alert(`Pirkimas: ${amount} vnt. (${price}‚Ç¨)`); closeModal(type==='std'?'modal-std':'modal-pro'); }

        document.addEventListener('DOMContentLoaded', () => {
            console.log("App Started");

            // --- 1. JUNGIMASIS PRIE SERVERIO (SVARBU!) ---
            let socket = null;
            try {
                // --- SAUGUS JUNGIMAS (Tinka ir Localhost, ir Render) ---
                const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
                const socket = new WebSocket(`${protocol}//${window.location.host}`);
                socket.onopen = () => console.log("‚úÖ WebSocket prisijungƒó sƒókmingai!");
                socket.onerror = (err) => console.error("‚ùå WebSocket klaida:", err);
            } catch (e) {
                console.log("Serveris nerastas arba neveikia WebSocket");
            }

            // --- 2. RAKETOS MYGTUKAS (SIUNTIMAS) ---
            const sendBtn = document.getElementById('btn-send-ai');
            const aiInput = document.getElementById('live-text');

            if(sendBtn) {
                sendBtn.onclick = () => {
                    const text = aiInput.value;
                    if(text && socket && socket.readyState === WebSocket.OPEN) {
                        // Siunƒçiam ƒØ serverƒØ
                        socket.send(JSON.stringify({ event: 'speak_text', text: text }));
                        console.log("üöÄ I≈°si≈≥sta ƒØ serverƒØ: " + text);
                        aiInput.value = ''; // I≈°valom
                    } else {
                        console.log("‚ùå Nepavyko i≈°si≈≥sti: Serveris neprijungtas arba tu≈°ƒçias tekstas.");
                    }
                };
            }

            // DUOMENYS
            const personas = [
                { id: 'tinder_girl', name: 'Mergina i≈° Tinder', type: 'pro', icon: 'üíã', phrases: { intro: ["Labas... kodƒól neatra≈°ai?", "A≈° ƒçia viena kaip durnƒó laukiu.", "A≈° viskƒÖ ≈æinau. Nemeluok."], middle: ["Kas ta boba tavo Storyje??", "A≈° nƒó≈°ƒçia. Reikia pasikalbƒót.", "Sakei neturi ≈æmonos, melagis!", "A≈° prie tavo laiptinƒós.ƒÆleisk.","Kodƒól tu tyli? KODƒñL TYLI??","Pervesk 20 eur≈≥ taksui dabar."], outro: ["Viskas, blokuoju tave, kiaule.", "Nekenƒçiu tavƒôs... (Verkia)", "Siunƒçiu viskƒÖ tavo motinai."] } },
                { id: 'tinder_guy', name: 'Vaikinas i≈° Tinder', type: 'pro', icon: 'üíî', phrases: { intro: ["Sveika"], middle: ["D≈æemperis"], outro: ["Viso"] } },
                { id: 'pastas', name: 'Pa≈°tininkas', type: 'std', icon: 'üìØ', phrases: { intro: ["Pa≈°tas"], middle: ["Muitas"], outro: ["Viso"] } },
                { id: 'indas', name: 'IT Pagalba', type: 'std', icon: 'üéß', phrases: { intro: ["Hello"], middle: ["Virus"], outro: ["Bye"] } },
                { id: 'kurjeris', name: 'Wolt Kurjeris', type: 'std', icon: 'üçï', phrases: { intro: ["Kurjeris"], middle: ["Neradau"], outro: ["Viso"] } },
                { id: 'kaimynas', name: 'Piktas Kaimynas', type: 'std', icon: 'ü§¨', phrases: { intro: ["Alo? ƒåia i≈° apaƒçios skambinu.", "Ar tu girdi save, kƒÖ darai?","Atidaryk duris, a≈° u≈æ dur≈≥!"], middle: ["Tu ten su plytom vaik≈°tai??", "Leidi vandenƒØ, man lubos ≈°lapios!", "KƒÖ ten stumdau? Baldus??", "U≈æsuk muzikƒÖ arba kvieƒçiu policijƒÖ!","Tu gal narkomanas koks?","Nekalbƒók su manim tokiu tonu!"], outro: ["Viskas, lipu ƒØ vir≈°≈≥.", "Lauk pareig≈´n≈≥, ra≈°au parei≈°kimƒÖ.","I≈°kraustysiu a≈° tave, pamatysi."]  } },
                { id: 'policija', name: 'Policija', type: 'std', icon: 'üöì', phrases: { intro: ["Policija"], middle: ["Skundas"], outro: ["Geros dienos"] } },
                { id: 'vmi', name: 'VMI Inspektorƒó', type: 'std', icon: 'üìâ', phrases: { intro: ["VMI"], middle: ["Bauda"], outro: ["SƒÖskaita"] } }
            ];
            
            let selectedPersona = null;
            let callInterval = null;
            let seconds = 0;

            const grid = document.getElementById('persona-grid');
            if(grid) {
                grid.innerHTML = '';
                personas.forEach(p => {
                    const div = document.createElement('div');
                    div.className = `persona-card ${p.type === 'pro' ? 'selected' : ''}`;
                    div.style.border = "1px solid #333";
                    div.innerHTML = `<span class="emoji-icon">${p.icon}</span><b>${p.name}</b>`;
                    if(p.type==='pro') div.innerHTML += ' <span style="color:#00e5ff; font-size:10px">PRO</span>';
                    div.onclick = () => {
                        selectedPersona = p;
                        document.querySelectorAll('.persona-card').forEach(c => c.style.borderColor = '#333');
                        div.style.borderColor = '#7c4dff';
                        document.getElementById('btn-start-setup').classList.remove('disabled');
                        document.getElementById('btn-start-setup').innerText = "TƒòSTI: " + p.name.toUpperCase();
                    };
                    grid.appendChild(div);
                });
            }

            const startBtn = document.getElementById('btn-start-setup');
            startBtn.onclick = () => {
                if(!selectedPersona) return;
                // JEI PRO -> EINAM ƒÆ SETUP, JEI STD -> TIESIAI
                if(selectedPersona.type === 'pro') {
                    document.getElementById('main-view').classList.add('hidden');
                    document.getElementById('setup-view').classList.remove('hidden');
                } else {
                    startCall();
                }
            };

            document.getElementById('btn-confirm-call').onclick = startCall;

            function startCall() {
                document.getElementById('main-view').classList.add('hidden');
                document.getElementById('setup-view').classList.add('hidden');
                document.getElementById('control-view').classList.remove('hidden');
                document.getElementById('active-persona-label').innerText = selectedPersona.name.toUpperCase();
                
                genBtns('group-intro', selectedPersona.phrases.intro);
                genBtns('group-middle', selectedPersona.phrases.middle);
                genBtns('group-outro', selectedPersona.phrases.outro);

                if(selectedPersona.type === 'pro') document.getElementById('pro-realtime').classList.remove('hidden');
                else document.getElementById('pro-realtime').classList.add('hidden');

                const btn = document.getElementById('btn-real-start');
                const newBtn = btn.cloneNode(true);
                btn.parentNode.replaceChild(newBtn, btn);

                newBtn.onclick = () => {
                    document.getElementById('rec-dot').style.opacity = 1;
                    document.getElementById('call-timer').innerText = "00:00";
                    seconds = 0;
                    if(callInterval) clearInterval(callInterval);
                    callInterval = setInterval(() => {
                        seconds++;
                        const m = Math.floor(seconds/60).toString().padStart(2,'0');
                        const s = (seconds%60).toString().padStart(2,'0');
                        document.getElementById('call-timer').innerText = `${m}:${s}`;
                    }, 1000);
                    newBtn.style.opacity = 0.5;
                };
            }

            function genBtns(id, list) {
                const c = document.getElementById(id);
                c.innerHTML = '';
                list.forEach(txt => {
                    const b = document.createElement('button');
                    b.className = 'phrase-btn';
                    b.innerText = txt;
                    b.onclick = () => {
                        b.style.borderColor = '#00ffaa';
                        setTimeout(()=>b.style.borderColor='#444', 300);
                    };
                    c.appendChild(b);
                });
            }

            document.getElementById('btn-end-call').onclick = () => {
                clearInterval(callInterval);
                document.getElementById('control-view').classList.add('hidden');
                document.getElementById('post-call-view').classList.remove('hidden');
                const m = Math.floor(seconds/60).toString().padStart(2,'0');
                const s = (seconds%60).toString().padStart(2,'0');
                document.getElementById('final-duration').innerText = `${m}:${s}`;
            };
        });
    </script>
</body>
</html>